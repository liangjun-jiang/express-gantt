<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gantt Plot &ndash; Project &ndash; Presented by Alipay US Engineering Team</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">
    <link rel=stylesheet type="text/css" href="project.css" >
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  
    <script type="text/javascript">
        function openForm() {
            document.getElementById("myForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
        }

        function submitForm(formId) {
            $.ajax("project", {
                dataType:"json",
                data: $(formId).serialize(),
                type:"POST",
                success: function(response) {
                   location.replace(`./index.html?projectId=${response.project.id}`)
                }
            })
            return false;
        }

        $(function() {
            $.getJSON("projects", null, function(response) {
                if (response.success) {
                    const section = $('<section class="post">').appendTo('.posts');
                    const projects = response.projects;
                    $(projects).each(function(index, project) {
                        section.append(
                            $('<header class="post-header">').html('<h1 class="post-title"><a href="index.html?projectId='+project.id+'">' + project.project_name +'</a></h1>')
                        );
                        section.append($('</header>'))
                        section.append(
                            $('<div class="post-description">').html('<p> '+ project.project_description +'</p>')
                        );
                        section.append($('</div>'))
                    });
                    $('</section>').appendTo('.posts');
                }
            })
      })
    </script>
  </head>
  <body>
    <nav>
      <a id="logo" href="#"></a>
      <a href="./projects.html">Home</a>
      <a onclick="openForm()">Create New Project</a>
      <a href="./tutorial.html">Tutorial</a>  
    </nav>

    <div id="layout" class="pure-g">
        <div class="sidebar pure-u-1 pure-u-md-1-4">
            <div class="header">
                <h1 class="brand-title">Gantt Project</h1>
                <h2 class="brand-tagline">Planning your project with gantt plot</h2>
            </div>
        </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            <div class="posts">
                <h1 class="content-subhead">Latest</h1>
            </div>

            <div class="footer">
                <div class="pure-menu pure-menu-horizontal">
                    <ul>
                        <li class="pure-menu-item"><a href="about.html" class="pure-menu-link">About</a></li>
                        <li class="pure-menu-item"><a href="#" class="pure-menu-link">GitLab</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
  </div>

    <div class="form-popup" id="myForm" >
        <form id="projectForm" action="" method="POST" class="form-container" target="_blank" onsubmit="return submitForm(this)">
        <h1>New Project</h1>
    
        <label for="project-name"><b>Project Name</b></label>
        <input type="text" placeholder="Enter a project name" name="project_name" required>
    
        <label for="psw"><b>Project Description</b></label>
        <textarea type="text" name="project_description" required rows="9"></textarea>
    
        <button type="submit" class="btn">Save</button>
        <button type="submit" class="btn cancel" onclick="closeForm()">Cancel</button>
        </form>
  </div>
  </body>
</html>